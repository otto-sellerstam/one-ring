name: Publish to PyPI

on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
    environment: pypi
    steps:
      - uses: actions/checkout@v6

      - name: Install uv
        uses: astral-sh/setup-uv@v7

      - name: Set up Python
        run: uv python install 3.14

      - name: Install just
        uses: extractions/setup-just@v2

      - name: Build all packages
        run: just build-all

      - name: Publish one-ring-core
        run: uv publish dist/one_ring_core-*

      - name: Publish one-ring-loop
        run: uv publish dist/one_ring_loop-*

      - name: Publish one-ring-http
        run: uv publish dist/one_ring_http-*

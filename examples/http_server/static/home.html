<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>one-ring-http</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #c9873d;
      --accent-glow: #c9873d44;
      --green: #3fb950;
      --red: #f85149;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 1.5rem;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
    }

    h1 span { color: var(--accent); }

    header p {
      color: var(--muted);
      font-size: 1.1rem;
    }

    .ring {
      width: 80px;
      height: 80px;
      border: 4px solid var(--accent);
      border-radius: 50%;
      margin: 0 auto 1.5rem;
      box-shadow: 0 0 20px var(--accent-glow), inset 0 0 20px var(--accent-glow);
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px var(--accent-glow), inset 0 0 20px var(--accent-glow); }
      50% { box-shadow: 0 0 40px var(--accent-glow), inset 0 0 40px var(--accent-glow); }
    }

    main {
      width: 100%;
      max-width: 640px;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .card h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .endpoint {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
    }

    .endpoint:last-child { border-bottom: none; }

    .method {
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      min-width: 3.5rem;
      text-align: center;
    }

    .method.get { background: #238636; color: #fff; }
    .method.post { background: #1f6feb; color: #fff; }

    .path {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      color: var(--text);
    }

    .desc {
      margin-left: auto;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .tester {
      display: flex;
      gap: 0.75rem;
    }

    .tester input {
      flex: 1;
      padding: 0.6rem 0.8rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-family: "SFMono-Regular", Consolas, monospace;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .tester input:focus { border-color: var(--accent); }

    .tester button {
      padding: 0.6rem 1.2rem;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .tester button:hover { opacity: 0.85; }

    #log {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .log-entry {
      padding: 0.5rem 0.75rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: "SFMono-Regular", Consolas, monospace;
      font-size: 0.8rem;
      display: flex;
      gap: 0.75rem;
      align-items: baseline;
    }

    .log-entry .ts { color: var(--muted); white-space: nowrap; }
    .log-entry .ok { color: var(--green); font-weight: 700; }
    .log-entry .err { color: var(--red); font-weight: 700; }
    .log-entry .pending { color: var(--accent); }
    .log-entry .body { color: var(--text); word-break: break-all; }

    .clear-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--muted);
      padding: 0.6rem 1rem;
      cursor: pointer;
      font-size: 0.8rem;
      transition: border-color 0.2s;
    }

    .clear-btn:hover { border-color: var(--text); color: var(--text); }

    footer {
      margin-top: 3rem;
      color: var(--muted);
      font-size: 0.85rem;
    }

    footer code {
      background: var(--surface);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="ring"></div>
    <h1><span>one-ring</span>-http</h1>
    <p>A tiny HTTP server powered by io_uring</p>
  </header>

  <main>
    <div class="card">
      <h2>Routes</h2>
      <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/</span>
        <span class="desc">Hello world (1s delay)</span>
      </div>
      <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/echo</span>
        <span class="desc">Echo request body</span>
      </div>
      <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/big</span>
        <span class="desc">1 MB response</span>
      </div>
      <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/*</span>
        <span class="desc">Static files</span>
      </div>
    </div>

    <div class="card">
      <h2>Try it</h2>
      <div class="tester">
        <input id="url" type="text" value="/" placeholder="/path">
        <button onclick="fetchUrl()">GET</button>
        <button class="clear-btn" onclick="clearLog()">Clear</button>
      </div>
      <div id="log"></div>
    </div>
  </main>

  <footer>
    Served by <code>one-ring-http</code> via <code>io_uring</code>
  </footer>

  <script>
    let reqId = 0;

    function ts() {
      const d = new Date();
      return d.toLocaleTimeString("en", { hour12: false }) + "." +
        String(d.getMilliseconds()).padStart(3, "0");
    }

    function addEntry(html) {
      const log = document.getElementById("log");
      const el = document.createElement("div");
      el.className = "log-entry";
      el.innerHTML = html;
      log.prepend(el);
      return el;
    }

    async function fetchUrl() {
      const path = document.getElementById("url").value;
      const id = ++reqId;
      const t0 = performance.now();
      const entry = addEntry(
        `<span class="ts">${ts()}</span>` +
        `<span class="pending">#${id} GET ${path} ...</span>`
      );

      try {
        const res = await fetch(path);
        const body = await res.text();
        const ms = (performance.now() - t0).toFixed(0);
        const cls = res.ok ? "ok" : "err";
        const preview = body.slice(0, 120) + (body.length > 120 ? "..." : "");
        entry.innerHTML =
          `<span class="ts">${ts()}</span>` +
          `<span class="${cls}">#${id} ${res.status} ${ms}ms</span>` +
          `<span class="body">${preview}</span>`;
      } catch (e) {
        const ms = (performance.now() - t0).toFixed(0);
        entry.innerHTML =
          `<span class="ts">${ts()}</span>` +
          `<span class="err">#${id} ERR ${ms}ms</span>` +
          `<span class="body">${e.message}</span>`;
      }
    }

    function clearLog() { document.getElementById("log").innerHTML = ""; reqId = 0; }
  </script>
</body>
</html>
